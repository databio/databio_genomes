metadata:
  sample_table: genomes.csv
  subsample_table: assets.csv

  output_dir: $GENOMES
  pipeline_interfaces: refgenie_piface.yaml

constant_attributes:
  protocol: "refgenie"
  destdir: "LOCALDIR"
  local_fa: "LOCAL_FA"
  local_gencode_gtf: "LOCAL_GENCODE_GTF"
  local_ensembl_gtf: "LOCAL_ENSEMBL_GTF"
  local_ensembl_rb: "LOCAL_ENSEMBL_RB"
  local_dbnsfp: "LOCAL_DBNSFP"
  local_refgene: "LOCAL_REFGENE"

derived_attributes: ['destdir', 'local_fa', 'local_gtf', 'local_gencode_gtf', 'local_ensembl_gtf', 'local_ensembl_rb', 'local_dbnsfp', 'local_refgene']

data_sources:
  LOCALDIR: "/project/shefflab/www/refgenie_raw/"
  LOCAL_FA: "{destdir}/{genome}.fa.gz"
  SRCFILE_FA: "{fasta}"
  LOCAL_GENCODE_GTF: "{destdir}/{genome}_gencode.gtf.gz"
  LOCAL_ENSEMBL_GTF: "{destdir}/{genome}_ensembl.gtf.gz"
  LOCAL_ENSEMBL_RB: "{destdir}/{genome}_ensembl_rb.gff.gz"
  LOCAL_DBNSFP: "{destdir}/{genome}_dbNSFP.zip"
  LOCAL_REFGENE: "{destdir}/{genome}_refGene.txt.gz"
  SRCFILE_GENCODE_GTF: "{gencode_gtf}"
  SRCFILE_ENSEMBL_GTF: "{ensembl_gtf}"
  SRCFILE_DBNSFP: "{dbnsfp}"
  SRCFILE_REFGENE: "{refgene}"
  SRCFILE_ENSEMBL_RB: "{ensembl_rb}"

subprojects:
  derive_sample_name:
    constant_attributes:
      sample_name: "genome_asset"
      protocol: "refgenie"
    derived_attributes: [sample_name]
    data_sources:
      genome_asset: "{genome}_{asset}"

  getfasta:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_FA"
      src: "SRCFILE_FA"
    derived_attributes: ["src", "destdir", "destfile"]

  getgtf:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_GENCODE_GTF"
      src: "SRCFILE_GENCODE_GTF"
    derived_attributes: ["src", "destdir", "destfile"]

  getensemblgtf:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_ENSEMBL_GTF"
      src: "SRCFILE_ENSEMBL_GTF"
    derived_attributes: ["src", "destdir", "destfile"]

  getrefgene:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_REFGENE"
      src: "SRCFILE_REFGENE"
    derived_attributes: ["src", "destdir", "destfile"]

  getensemblrb:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_ENSEMBL_RB"
      src: "SRCFILE_ENSEMBL_RB"
    derived_attributes: ["src", "destdir", "destfile"]

  getdbnsfp:
    metadata:
      pipeline_interfaces: wget_piface.yaml
      subsample_table: null
    constant_attributes:
      destdir: "LOCALDIR"
      destfile: "LOCAL_DBNSFP"
      src: "SRCFILE_DBNSFP"
    derived_attributes: ["src", "destdir", "destfile"]
